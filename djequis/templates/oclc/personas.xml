{% load filters %}
<?xml version="1.0" encoding="UTF-8"?>
<oclcPersonas xmlns="http://worldcat.org/xmlschemas/IDMPersonas-1.1" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://worldcat.org/xmlschemas/IDMPersonas-1.1 http://worldcat.org/xmlschemas/IDMPersonas/1.1/IDMPersonas-1.1.xsd ">
    {% for o in objs %}
        {% spaceless %}
        {% if o.groupIndex == "3" %}
            {% with grouping as "Faculty" %}{% endwith %}
        {% else %}
            {% if o.groupIndex == "2" %}
                {% with grouping as "Staff" %}{% endwith %}
            {% else %}
                {% if o.groupIndex == "1" %}
                    {% with grouping as "Student" %}{% endwith %}
                {% else %}
                    {% with grouping as "Other" %}{% endwith %}
                {% endif %}
            {% endif %}
        {% endif %}
        {% endspaceless %}
        {% if o.email %}
            <persona institutionId="3164">
                <correlationInfo>
                    <sourceSystem>urn:mace:oclc:idm:gzc:ldap</sourceSystem>
                    <idAtSource>{{o.email|get_ldap_username}}</idAtSource>
                </correlationInfo>
                <nameInfo>
                    <givenName>{{o.firstname}}</givenName>
                    {% if o.middlename %}<middleName>{{o.middlename}}</middleName>{% endif %}
                    <familyName>{{o.lastname}}</familyName>
                </nameInfo>
                <wmsCircPatronInfo>
                    <barcode>{{o.id|stringformat:"010d"}}</barcode>
                    <borrowerCategory>{{ grouping }}</borrowerCategory>
                    <circRegistrationDate>2010-01-01T12:00:00</circRegistrationDate>
                    <circExpirationDate>{{next_year|date:"c"}}</circExpirationDate>
                    <homeBranch>131408</homeBranch>
                </wmsCircPatronInfo>
                <contactInfo>
                    <email>
                        <emailAddress>{{o.email}}</emailAddress>
                        <isPrimary>true</isPrimary>
                    </email>
                </contactInfo>
                <contactInfo>
                    <physicalLocation>
                        <postalAddress>
                            <streetAddressLine1>{{o.addr_line1}}</streetAddressLine1>
                            {% if o.addr_line2 %}<streetAddressLine2>{{o.addr_line2}}</streetAddressLine2>{% endif %}
                            <cityOrLocality>{{o.city}}</cityOrLocality>
                            <stateOrProvince>{{o.st}}</stateOrProvince>
                            <postalCode>{{o.zip}}</postalCode>
                            <country>{{o.ctry}}</country>
                        </postalAddress>
                        <phone>
                            <number>{{o.phone}}</number>
                            <isPrimary>true</isPrimary>
                        </phone>
                        <isPrimary>true</isPrimary>
                    </physicalLocation>
                </contactInfo>
            </persona>
        {% endif %}
    {% endfor %}
</oclcPersonas>
